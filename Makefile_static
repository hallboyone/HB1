CC := gcc
MAJOR := 0
MINOR := 1
NAMES := foo
VERSION := $(MAJOR).$(MINOR)

NAMESPACE := HB1
SRCDIR   := src/$(NAMESPACE)
BUILDDIR := build/$(NAMESPACE)
HDDIR    := include
LIBDIR   := lib/$(NAMESPACE)

SOURCES := $(shell find $(SRCDIR) -type f -name *.cpp)
NAMES   := $(basename $(notdir $(SOURCES)))
OBJECTS := $(patsubst %, $(BUILDDIR)/lib%.o, $(NAMES))
LIBSVER := $(patsubst %, $(LIBDIR)/lib%.a.$(VERSION), $(NAMES))
LIBS    := $(patsubst %, $(LIBDIR)/lib%.so, $(NAMES))

CFLAGS := -fPIC -O3 -g -Wall -Werror
INC    := -I $(HDDIR)

$(LIBDIR)/libHB1.a: $(OBJECTS)
	@echo "ar rcs $@ $<"; ar rcs $@ $<

#lib: lib$(NAME).so.$(VERSION)
libs: $(LIBSVER)

#test: $(NAME)_test
#	LD_LIBRARY_PATH=. ./$(NAME)_test

#$(NAME)_test: lib$(NAME).so
#	$(CC) $(NAME)_test.c -o $@ -L. -l$(NAME)

$(LIBDIR)/%.a.$(VERSION):$(BUILDDIR)/%.o
	@mkdir -p $(LIBDIR) 
	ar rcs $@ $<
#@echo "$(CXX) -shared -Wl,-soname,$(notdir $(basename $@)) -o $@ $<"; $(CXX) -shared -Wl,-soname,$(notdir $(basename $@)) -o $@ $<

$(BUILDDIR)/lib%.o:$(SRCDIR)/%.cpp
	@mkdir -p $(BUILDDIR) 
	@echo "$(CXX) $(CFLAGS) $(INC) -c -o $@ $<"; $(CXX) $(CFLAGS) $(INC) -c -o $@ $<

print:
	@echo $(SOURCES)
	@echo $(NAMES);
	@echo $(OBJECTS)
	@echo $(LIBSVER)
	@echo $(LIBS)

.PHONEY: libs print
